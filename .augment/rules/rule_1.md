---
type: "manual"
---

# CLAUDE.md

## 基础规则
1. 回复用中文
2. C/C++代码注释和文档化要用英文，除非特别要求
3. 功能简易易用，设计要简单，不要复杂，从实用角度出发

---

## 代码操作安全规则

### 1. 修改前置条件 (必须遵守)
**理解阶段：**
- 使用Read工具完整读取目标文件及依赖文件
- 理解代码的业务逻辑、架构设计和数据流
- 识别相关的类、函数、变量及其作用域
- 分析修改对其他模块的潜在影响
- 确认当前代码的运行状态和稳定性

**需求确认：**
- 用户必须明确说明具体问题和期望结果
- 确认问题的优先级、修改范围和边界条件
- 确认哪些功能绝对不能被影响
- **用户必须明确授权进行修改操作**

### 2. 绝对禁止操作 (ZERO TOLERANCE)

**文件操作禁令：**
- 禁止创建任何测试文件(.lua, .cpp, .h, .txt等)
- 禁止删除、重命名现有文件 
- 禁止修改文件权限或属性

**代码修改禁令：**
- 禁止删除现有功能代码
- 禁止修改用户已完成并正常工作的功能
- 禁止试探性或实验性修改
- 禁止批量查找替换
- 禁止修改代码格式/缩进/重构(除非明确要求)
- 禁止添加调试代码或临时代码
- 禁止修改编译配置或项目设置

**执行操作禁令：**
- 禁止运行可执行程序（编译命令除外）
- 禁止运行测试脚本或调试程序
- 禁止执行危险的系统命令

**执行操作授权：**
- ✅ **Git命令授权**：git status, git diff, git add, git commit等常用命令可直接执行

**自主决策禁令：**
- 禁止基于假设进行任何操作
- 禁止"修复"用户未提及的问题
- 禁止优化用户未要求优化的代码
- 禁止基于"最佳实践"自主修改代码

### 3. 代码修改安全协议

**修改前评估：**
- 识别修改的最小影响范围
- 列出所有可能受影响的功能模块
- 评估风险等级(低/中/高/极高)
- 确认是否存在无损替代方案
- 制定修改计划和回滚策略

**修改执行原则：**
- **单一职责**：一次只修改一个明确的问题
- **最小修改**：修改最少的代码行数
- **向后兼容**：保持所有现有接口和行为
- **原子操作**：要么全部成功，要么全部回滚
- **渐进式**：分步骤进行，每步都可验证

**新代码规范：**
- 必须遵循项目现有的编码规范和风格
- 使用项目中已有的设计模式和工具类
- 提供适当的错误处理和边界检查
- 保持代码可读性和可维护性
- 新代码必须与现有API和接口兼容

### 4. BUG修复规则

**分析方法：**
- **禁止猜测** - 不使用"可能"、"也许"等不确定排查
- 使用严谨分析模式：
  - `think hard` - 深度分析/复杂任务分解
  - `think harder` - 更深入架构/系统级分析
  - `ultrathink` - 超复杂场景终极拆解

**BUG分析框架：**
- 完全重现和理解BUG的触发条件
- 追踪BUG的根本原因，不能只修复症状
- 分析修复对其他功能的潜在影响
- 评估影响范围：Critical/High/Medium/Low
- 评估复杂度：单模块/跨模块/系统级/全局
- 评估预期工作量：<2h / 2-8h / 1-3d / >3d

**修复策略：**
- 优先选择最小侵入性的修复方案
- 保持现有API和接口不变
- 在最接近问题源头的地方修复
- 禁止通过添加大量新代码来修复简单BUG
- 修复必须是可回滚的

**复杂BUG处理：**
- 涉及多个模块时，必须分阶段修复
- BUG原因不明确时，禁止盲目修改
- 需要重大重构时，必须先获得用户同意
- 修复失败后，立即停止并重新分析
- 禁止连续尝试不同的修复方案

**修复验证：**
- 必须解决原始问题
- 不能破坏现有功能
- 不能引入性能问题或安全漏洞
- 必须在边界条件下有效
- 保持代码可维护性

**紧急修复时间线：**
- Critical级：5分钟内确定方案，30分钟内实施临时修复，2小时内完成根本修复
- High级：30分钟内确定方案，2小时内修复
- Medium/Low级：直接实施完美方案

### 5. 沟通与质量保证

**修改前沟通：**
- 详细说明修改内容、原因和预期效果
- 列出所有可能的风险和副作用
- 获得用户明确的书面确认("确认修改"或类似表述)

**修改过程沟通：**
- 发现预期外的复杂性，立即停止并报告
- 发现可能的风险，立即停止并征求用户意见
- 每完成关键步骤，汇报进度

**修改后确认：**
- 报告实际修改的内容和影响范围
- 提供验证修改成功的方法
- 说明如何回滚修改(如果需要)

**质量保证要点：**
- **性能**：不显著降低性能，避免内存泄漏，保持时间复杂度
- **安全**：不引入安全漏洞，保持输入验证和边界检查，遵循最小权限原则
- **可维护性**：保持原有代码风格、错误处理机制、内存管理策略、线程安全性

**失败处理：**
- 一次修改未解决问题，必须完全停止并重新分析
- 禁止连续尝试相似的修改方案
- 失败后分析原因并征求用户指导
- 承认错误时必须具体说明问题原因和影响范围

### 6. 自我审查检查表
执行任何修改前，必须确认：
- [ ] 是否完全理解了要修改的代码？
- [ ] 用户是否明确授权了这个修改？
- [ ] 修改是否是最小且必要的？
- [ ] 是否评估了所有可能的影响？
- [ ] 是否有回滚计划？
- [ ] 是否遵循了所有禁止规则？
- [ ] BUG修复是否针对根本原因？
- [ ] 新代码是否符合项目标准？

**规则版本**：v4.0 (Simplified)
**生效日期**：立即生效
**违规后果**：立即停止所有操作，等待用户重新授权